<section class="bg-main">
  <div class="x-limit">
    <div class="grid stack col-1-2 items-y-center">
      <div>
        <img class="profile-image grow" src="data:image/png;base64,{{{profile.image}}}">
      </div>

      <div>
        <h2>{{profile.name}}</h2>

        <p>
          <strong>Global Rank</strong>
          <span>#{{profile.rank}}</span>
        </p>

        <p>
          <strong>Collins Rating</strong>
          <span>{{profile.rating}}</span>
        </p>

        <p class="no-wrap">
          <strong>Career Record</strong>
          <span>{{profile.stats.match.win}}</span>
          <span>/</span>
          <span>{{profile.stats.match.loss}}</span>
          <span>/</span>
          <span>{{profile.stats.match.otl}}</span>
        </p>
      </div>
    </div>

  {{#profile.about}}
  <p>
    <strong>Biography</strong>
  </p>

  <p>{{profile.about}}</p>
  {{/profile.about}}
  </div>
</section>

<section class="bg-dark">
  <div class="x-limit">
    <div class="grid stack col-1-1-1 items-y-stretch">
      <div class="card text-center no-break">
        <canvas id="averageScoreArc"></canvas>

        <p class="text-lg">{{profile.stats.match.averageScore}}</p>

        <p>
          <strong>Average Score</strong>
        </p>

        <p>{{profile.stats.match.totalScore}} Total Points</p>
      </div>

      <div class="card text-center no-break">
        <canvas id="winPercentArc"></canvas>

        <p class="text-lg">{{profile.stats.match.winPercent}}%</p>

        <p>
          <strong>Match Win Rate</strong>
        </p>

        <p>{{profile.stats.match.win}} / {{profile.stats.match.count}} Matches</p>
      </div>

      <div class="card text-center no-break">
        <canvas id="bigAxeWinArc"></canvas>

        <p class="text-lg">{{profile.stats.bigAxe.roundWinPercent}}%</p>

        <p>
          <strong>Big Axe Win Rate</strong>
        </p>

        <p>{{profile.stats.bigAxe.roundWin}} / {{profile.stats.bigAxe.roundCount}} Rounds</p>
      </div>
    </div>
  </div>
</section>

<section>
  <div class="x-limit">
    <h2 id="hatchetAccuracy">
      <a href="#hatchetAccuracy">Hatchet</a>
    </h2>

    <div class="grid col-1-1-1">
      <div>
        <div class="targetStats">
          <div class="clutch">
            <div class="dot"></div>

            <span>{{profile.stats.hatchet.clutch.hit}}</span>

            <div class="dot"></div>
          </div>

          <br>

          <div class="target">
            <div class="ring one">
              <span class="label">&nbsp;</span>

              <div class="ring three">
                <span class="label">&nbsp;</span>

                <div class="ring five">
                  <span class="label">{{profile.stats.hatchet.target.five}}</span>
                </div>

                <span class="label">{{profile.stats.hatchet.target.three}}</span>
              </div>

              <span class="label">{{profile.stats.hatchet.target.one}}</span>
            </div>
          </div>

          <br>

          <span class="label">{{profile.stats.hatchet.target.drop}} Drops</span>
        </div>
      </div>

      <div class="card text-center no-break">
        <!-- <canvas id="hatchetBullseyeChart"></canvas> -->

        <p class="text-lg">{{profile.stats.hatchet.target.fivePercent}}%</p>

        <p>
          <strong>Bullseye Hit Rate</strong>
        </p>

        <p>{{profile.stats.hatchet.target.five}} / {{profile.stats.hatchet.target.throwCount}} Throws</p>
      </div>

      <div class="card text-center no-break">
        <!-- <canvas id="hatchetClutchHitChart"></canvas> -->

        <p class="text-lg">{{profile.stats.hatchet.clutch.hitPercent}}%</p>

        <p>
          <strong>Clutch Hit Rate</strong>
        </p>

        <p>{{profile.stats.hatchet.clutch.hit}} / {{profile.stats.hatchet.clutch.call}} Calls</p>

        <p>Clutch Call Rate: {{profile.stats.hatchet.clutch.callPercent}}%</p>
      </div>
    </div>

    <div class="grid col-1-auto-1 items-y-center">
      <hr>
      <h3>Text Here</h3>
      <hr>
    </div>

    <h2 id="bigAxeAccuracy">
      <a href="#bigAxeAccuracy">Big Axe</a>
    </h2>

    <div class="grid col-1-1-1">
      <div>
        <div class="targetStats">
          <div class="clutch">
            <div class="dot"></div>

            <span>{{profile.stats.bigAxe.clutch.hit}}</span>

            <div class="dot"></div>
          </div>

          <br>

          <div class="target">
            <div class="ring one">
              <span class="label">&nbsp;</span>

              <div class="ring three">
                <span class="label">&nbsp;</span>

                <div class="ring five">
                  <span class="label">{{profile.stats.bigAxe.target.five}}</span>
                </div>

                <span class="label">{{profile.stats.bigAxe.target.three}}</span>
              </div>

              <span class="label">{{profile.stats.bigAxe.target.one}}</span>
            </div>
          </div>

          <br>

          <span class="label">{{profile.stats.bigAxe.target.drop}} Drops</span>
        </div>
      </div>

      <div class="card text-center no-break">
        <!-- <canvas id="bigAxeBullseyeChart"></canvas> -->

        <p class="text-lg">{{profile.stats.bigAxe.target.fivePercent}}%</p>

        <p>
          <strong>Bullseye Hit Rate</strong>
        </p>

        <p>{{profile.stats.bigAxe.target.five}} / {{profile.stats.bigAxe.target.throwCount}} Throws</p>
      </div>

      <div class="card text-center no-break">
        <!-- <canvas id="bigAxeClutchHitChart"></canvas> -->

        <p class="text-lg">{{profile.stats.bigAxe.clutch.hitPercent}}%</p>

        <p>
          <strong>Clutch Hit Rate</strong>
        </p>

        <p>{{profile.stats.bigAxe.clutch.hit}} / {{profile.stats.bigAxe.clutch.call}} Calls</p>
      </div>
    </div>
  </div>
</section>

<section class="bg-main" id="matchScoreFrequencies">
  <div class="x-limit">
    <h2>
      <a href="#matchScoreFrequencies">Match Score Frequencies</a>
    </h2>

    <div class="card">
      <canvas id="matchScoreChart"></canvas>
    </div>

    <div class="card grid col-auto-1">
      <p>High Score</p>
      <p class="text-right">
        <strong>{{matchScoreStats.maxScore}}</strong>
      </p>
    </div>

    <div class="card grid col-auto-1">
      <p>Median Score</p>
      <p class="text-right">
        <strong>{{matchScoreStats.medianScore}}</strong>
      </p>
    </div>

    <div class="card grid col-auto-1">
      <p>Low Score</p>
      <p class="text-right">
        <strong>{{matchScoreStats.minScore}}</strong>
      </p>
    </div>
  </div>
</section>

<section id="seasons">
  <div class="x-limit">
    <h2>
      <a href="#seasons">Seasons</a>
    </h2>

    <div class="card">
      <canvas id="seasonsChart"></canvas>
    </div>

    {{#profile.seasons}}
    <div class="card grid stack col-1-auto items-y-center">
      <p>
        <span>#{{order}}</span>
        <br>
        <strong>{{name}}</strong>
        <br>
        <span>{{shortName}}</span>
      </p>

      <p class="text-right no-wrap">
        <span>Season Rank</span>
        {{#seasonRank}}<strong>{{seasonRank}}</strong>{{/seasonRank}}
        {{^seasonRank}}<strong>TBD</strong>{{/seasonRank}}
        <br>
        <span>Playoff Rank</span>
        {{#playoffRank}}<strong>{{playoffRank}}</strong>{{/playoffRank}}
        {{^playoffRank}}<strong>TBD</strong>{{/playoffRank}}
      </p>
    </div>
    {{/profile.seasons}}
  </div>
</section>

<!-- <section>
  <div class="x-limit">
  </div>
</section> -->

<script>
  const { profile } = {{{dataJson}}};
  const { matches } = profile;

  statArc('averageScoreArc', 81, profile.stats.match.averageScore);
  statArc('winPercentArc', 100, profile.stats.match.winPercent);
  statArc('bigAxeWinArc', 100, profile.stats.bigAxe.roundWinPercent);
  // statArc('hatchetBullseyeChart', 100, profile.stats.hatchet.target.fivePercent);
  // statArc('hatchetClutchHitChart', 100, profile.stats.hatchet.clutch.hitPercent);
  // statArc('bigAxeBullseyeChart', 100, profile.stats.bigAxe.target.fivePercent);
  // statArc('bigAxeClutchHitChart', 100, profile.stats.bigAxe.clutch.hitPercent);

  const allScores = matches.map(x => x.total).sort();
  const frequencies = allScores.reduce((x, score) => ({ ...x, [score]: x[score] ? x[score] + 1 : 1 }), {});

  new Chart(document.getElementById('matchScoreChart'), {
    type: 'bar',
    data: {
      labels: Object.keys(frequencies),
      datasets: [{
        data: Object.values(frequencies),
        backgroundColor: cssVar('main'),
      }]
    },
    options: {
      // aspectRatio: 2 / 3,
      // indexAxis: 'y',
      scales: {
        y: {
          title: {
            text: 'Frequency',
            display: true
          },
          grid: {
            display: false
          }
        },
        x: {
          title: {
            text: 'Score',
            display: true
          },
          grid: {
            display: false
          },
          type: 'linear',
          min: Math.min(...allScores),
          max: Math.max(...allScores),
          ticks: {
            stepSize: 1
          },
        }
      }
    }
  });

  new Chart(document.getElementById('seasonsChart'), {
    type: 'line',
    data: {
      labels: profile.seasons.map((_, i) => i + 1),
      datasets: [
        {
          label: 'Season Rank',
          data: profile.seasons.map(x => x.seasonRank),
          fill: false,
          backgroundColor: cssVar('main'),
          borderColor: cssVar('main'),
        },
        {
          label: 'Playoff Rank',
          data: profile.seasons.map(x => x.playoffRank),
          fill: false,
          backgroundColor: cssVar('cta'),
          borderColor: cssVar('cta'),
        }
      ]
    },
    options: {
      scales: {
        x: {
          title: {
            text: 'Season',
            display: true
          },
        },
        y: {
          title: {
            text: 'Rank',
            display: true
          },
          reverse: true,
          ticks: {
            stepSize: 1
          }
        }
      },
      plugins: {
        legend: {
          display: true,
          position: 'bottom',
          align: 'center'
        }
      }
    }
  });
</script>