<script>
  const DATA = {{{profilesJSON}}};

  document.addEventListener('alpine:init', () => {
    Alpine.store('search', {
      results: DATA.slice(0),
      execute(value) {
        const term = value.trim().toLowerCase();

        this.results = term.length < 1 ? DATA.slice(0) : DATA.filter(({ name }) => {
          return name.toLowerCase().includes(term);
        });
      }
    });
  });
</script>

<section class="bg-main">
  <div class="x-limit">
    <h2>IATF Profiles</h2>

    <p>The following list displays IATF profiles with a global rank in the Premier ruleset.</p>
  </div>
</section>

<section class="bg-dark" x-data>
  <div class="x-limit">
    <div class="card">
      <div class="split stack y-center">
        <p>
          <strong>Search</strong>
        </p>

        <div>
          <input type="text" placeholder="Name" @input.debounce.500ms="$store.search.execute($event.target.value)">
        </div>
      </div>
    </div>
  </div>
</section>

<section x-data>
  <div class="x-limit">
    <figure>
      <table class="text-center">
        <thead>
          <tr>
            <th>Name</th>
            <th>Global Rank</th>
            <th>Collins Rating</th>
            <th>Average Score</th>
          </tr>
        </thead>

        <tbody>
          <template x-if="$store.search.results.length < 1">
            <tr>
              <td colspan="4">No results.</td>
            </tr>
          </template>

          <template x-for="profile in $store.search.results" :key="profile.id">
            <tr>
              <td>
                <a :href="`/profile/${profile.id}`" x-text="profile.name"></a>
              </td>
              <td x-text="profile.premierRank"></td>
              <td x-text="profile.premierRating"></td>
              <td x-text="profile.premierAverage"></td>
            </tr>
          </template>
        </tbody>
      </table>
    </figure>
  </div>
</section>