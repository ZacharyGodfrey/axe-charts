<script>
  const STATE = {
    all: [],
    results: [],
    async init() {
      const context = this;

      await fetch('/all-data.json')
        .then(res => res.json())
        .then(data => {
          context.all = data.profiles;
        });
    },
    search(text) {
      this.results = text.length === 0 ? [] : this.all.filter(({ name }) => {
        return name.toLowerCase().includes(text.toLowerCase());
      });
    }
  };
</script>

<section class="bg-main" x-data="STATE">
  <div class="x-limit">
    <h2>Find Your Profile</h2>

    <div class="card">
      <div class="split stack y-center">
        <p>
          <strong>Search</strong>
        </p>

        <div>
          <input type="text" placeholder="Name" @input.debounce.500ms="search($event.target.value)">
        </div>
      </div>
    </div>

    <div class="card" x-cloak x-show="profiles.length > 0">
      <ul>
        <template x-for="profile in profiles" :key="profile.id">
          <li>
            <a :href="`/profile/${profile.id}`" x-text="profile.name"></a>
          </li>
        </template>
      </ul>
    </div>
  </div>
</section>

<section class="bg-dark">
  <div class="x-limit">
    <h2>Global Rankings</h2>

    <div class="split stack">
      <div class="card grow">
        <h3>IATF Premier</h3>

        <ul>
          <li>
            <strong class="no-break">{{premier.count}}</strong>
            <span>throwers</span>
          </li>

          <li>
            <strong class="no-break">{{premier.averageRating}}</strong>
            <span>average Collins Rating</span>
          </li>

          <li>
            <strong class="no-break">{{premier.averageScore}}</strong>
            <span>average score</span>
          </li>
        </ul>

        <p class="text-center">
          <a class="button" href="/premier">View Ranking</a>
        </p>
      </div>

      <div class="card grow">
        <h3>IATF Standard</h3>

        <ul>
          <li>
            <strong class="no-break">{{standard.count}}</strong>
            <span>throwers</span>
          </li>

          <li>
            <strong class="no-break">{{standard.averageRating}}</strong>
            <span>average Collins Rating</span>
          </li>

          <li>
            <strong class="no-break">{{standard.averageScore}}</strong>
            <span>average score</span>
          </li>
        </ul>

        <p class="text-center">
          <a class="button" href="/standard">View Ranking</a>
        </p>
      </div>
    </div>
  </div>
</section>

<section>
  <div class="x-limit">
    <h2>NOTICE</h2>

    <ul>
      <li>This website is still under construction. Only a few throwers have profile pages right now. All other profiles will be added soon.</li>
      <li>All data on this site is pulled from the official IATF source on a weekly basis.</li>
      <li>
        <span>Total Thrower Count:</span>
        <strong class="no-break">{{totalProfiles}}</strong>
      </li>
      <li>
        <span>Data Last Updated:</span>
        <strong class="no-break">{{updatedAt}}</strong>
      </li>
    </ul>
  </div>
</section>