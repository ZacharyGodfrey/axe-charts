<script>
  const DATA = {{{profilesJSON}}};

  const search = {
    results: [],
    execute(value) {
      const term = value.trim().toLowerCase();

      this.results = term.length < 1 ? [] : DATA.filter(({ name }) => {
        return name.toLowerCase().includes(term);
      });
    }
  };
</script>

<section class="bg-main" x-data="search">
  <div class="x-limit">
    <h2>Find Your Profile</h2>

    <div class="card">
      <div class="split stack y-center">
        <p>
          <strong>Search</strong>
        </p>

        <div>
          <input type="text" placeholder="Name" @input.debounce.500ms="execute($event.target.value)">
        </div>
      </div>
    </div>

    <template x-if="results.length > 0">
      <div class="card">
        <ul>
          <template x-for="profile in results" :key="profile.id">
            <li>
              <a :href="`/profile/${profile.id}`" x-text="profile.name"></a>
            </li>
          </template>
        </ul>
      </div>
    </template>
  </div>
</section>

<section class="bg-dark">
  <div class="x-limit">
    <h2>Global Statistics</h2>

    <div class="card">
      <ul>
        <li>
          <span>IATF Premier Profiles:</span>
          <strong class="no-break">{{premier.count}}</strong>
        </li>

        <li>
          <span>Average Collins Rating:</span>
          <strong class="no-break">{{premier.averageRating}}</strong>
        </li>

        <li>
          <span>Average Match Score</span>
          <strong class="no-break">{{premier.averageScore}}</strong>
        </li>
      </ul>

      <p class="text-center">
        <a class="button" href="/profiles">View Ranking</a>
      </p>
    </div>
  </div>
</section>

<section>
  <div class="x-limit">
    <p>All data on this site is pulled from the official IATF source.</p>

    <p>The data was last updated on <strong class="no-break">{{timestamp}}</strong>.</p>
  </div>
</section>