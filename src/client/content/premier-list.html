<script>
  const DATA = {{{JSON}}};
  const STATE = {
    pageSize: 100,
    currentPage: 1,
    totalPages: 1,
    searchResult: [],
    pages: [[]],
    init() {
      this.search('');
    },
    async search(text) {
      console.log(`Finding profiles with name: ${text}`);

      this.currentPage = 1;
      this.searchResult = text.length === 0 ? DATA.slice(0) : DATA.filter(({ name }) => name.includes(text));
      this.pages = paginate(this.searchResult, this.pageSize);
    },
    firstPage() {
      this.currentPage = 1;
    },
    previousPage() {
      this.currentPage = Math.max(1, this.currentPage - 1);
    },
    nextPage() {
      this.currentPage = Math.min(this.currentPage + 1, this.pages.length);
    },
    lastPage() {
      this.currentPage = this.pages.length;
    }
  };

  const debounce = (action, delay) => {
    let timer = null;

    return (...args) => {
      clearTimeout(timer);

      timer = setTimeout(() => {
        action.apply(null, args);
      }, delay);
    };
  };

  const paginate = (data, size) => {
    return data.reduce((pages, item, index) => {
      const lastPage = pages[pages.length - 1];

      if (lastPage.length < size) {
        lastPage.push(item);
      } else {
        pages.push([item]);
      }

      return pages;
    }, [[]]);
  };

  const typeAhead = debounce((text) => {
    STATE.search(text).then(() => console.log(STATE.pages[STATE.currentPage - 1]));
  }, 500);
</script>

<section x-data="STATE">
  <div class="x-limit">
    <h2>Premier Throwers</h2>

    <input type="text" @input="typeAhead($event.target.value)">

    <p class="text-right">
      <span>Page</span>
      <strong x-text="currentPage"></strong>
      <span>of</span>
      <strong x-text="pages.length"></strong>
      <br>
      <strong x-text="pageSize"></strong>
      <span>items per page</span>
    </p>

    <figure>
      <table class="text-center">
        <thead>
          <tr>
            <th>Name</th>
            <th>Global Rank</th>
            <th>Collins Rating</th>
            <th>Career Average Score</th>
          </tr>
        </thead>

        <tbody>
          {{#list}}
          <tr>
            <td>
              <a href="/profile/{{id}}">{{name}}</a>
            </td>
            <td>{{premierRank}}</td>
            <td>{{premierRating}}</td>
            <td>{{premierAverage}}</td>
          </tr>
          {{/list}}
        </tbody>
      </table>
    </figure>
  </div>
</section>