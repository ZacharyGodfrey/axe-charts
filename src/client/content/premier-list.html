<script>
  const DATA = {{{JSON}}};

  const debounce = (action, delay) => {
    let timer = null;

    return (...args) => {
      clearTimeout(timer);

      timer = setTimeout(() => {
        action.apply(null, args);
      }, delay);
    };
  };

  const STATE = {
    term: '',
    profiles: DATA.slice(0, 100),
    search(text) {
      console.log(`Searching: ${text}`);

      this.term = text;
      this.profiles = text.length === 0 ? DATA.slice(100) : DATA.filter(({ name }) => {
        return name.toLowerCase().includes(text.toLowerCase());
      });
    }
  };
</script>

<section x-data="STATE">
  <div class="x-limit">
    <h2>Premier Throwers</h2>

    <input type="text" @input.debounce.500ms="search($event.target.value)">

    <p>
      <span>Term:</span>
      <strong x-text="term"></strong>
    </p>

    <p>
      <span>Matches:</span>
      <strong x-text="profiles.length"></strong>
    </p>

    <figure>
      <table class="text-center">
        <thead>
          <tr>
            <th>Name</th>
            <th>Global Rank</th>
            <th>Collins Rating</th>
            <th>Career Average Score</th>
          </tr>
        </thead>

        <tbody>
          <template x-for="profile in profiles" :key="profile.id">
            <tr>
              <td>
                <a :href="`/profile/${profile.id}`" x-text="profile.name"></a>
              </td>
              <td x-text="profile.premierRank"></td>
              <td x-text="profile.premierRating"></td>
              <td x-text="profile.premierAverage"></td>
            </tr>
          </template>
        </tbody>
      </table>
    </figure>
  </div>
</section>